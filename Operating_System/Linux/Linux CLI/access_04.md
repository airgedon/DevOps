# Пользователи, права доступа
- Пользователи, права доступа: useradd, usermod, chown, chmod, passwd...
---
> :mag_right: По замыслу создателей, Linux-системы — это многопользовательские операционные системы, т.е. позволяющие нескольким пользователям работать с одной системой, не мешая друг другу. Но пользователи, совместно использующие доступ к файлам, рискуют раскрыть секретную информацию или даже потерять данные, если другие пользователи получат доступ к их файлам или каталогам. Чтобы решить эту проблему, в Linux добавили механизмы владения и прав доступа к файлам (или каталогам), чтобы обозначить, какие полномочия каждый пользователь имеет над определенным файлом (или каталогом).

# :bulb: Команда «useradd»
> Для создания пользователей из командной строки обычно используют команду adduser.
 
- Чтобы создать нового пользователя, выполняем команду adduser и указываем имя пользователя
> ⚠️ вместо devops укажите имя пользователя, которого вы создаете
 
```
sudo adduser devops
```
После запуска данной команды, вы должны ввести пароль для нового пользователя. Затем будет предложено ввести дополнительную информацию о пользователе: имя, номер комнаты (кабинета), телефоны и комментарий.

> :mag_right: Вводить эту информацию необязательно. Просто нажимайте Enter, чтобы пропустить ввод данных.

<p align="center">
<img src="https://media.giphy.com/media/PdEnlAIDJx6PzDK7DL/giphy.gif">
</p>

В результате выполнения команды adduser будут выполнены следующие действия
- Создается новый пользователь с именем, которое вы указали при выполнении команды.
- Создается группа с тем же именем.
- Создается домашний каталог пользователя в директории /home/имяпользователя 
- В домашний каталог копируются файлы из директории /etc/skel. В данной директории хранятся файлы, которые копируются в домашний каталог всех новых пользователей.

# :bulb: Команда «usermod»
> Команда usermod или изменить пользователя — это команда в Linux, которая используется для изменения свойств пользователя в Linux через командную строку. После создания пользователя нам иногда приходится менять его атрибуты, такие как пароль, каталог для входа и т. д
```
 usermod [опции] [синтаксис]
```
Здесь нас будут интересовать только несколько опций с помощью которых можно добавить пользователя в группу root linux.
- -G - дополнительные группы для пользователя;
- -a - добавить пользователя в дополнительные группы из параметра -G, а не заменять им текущее значение;
- -g - установить новую основную группу для пользователя, такая группа уже должна существовать, и все файлы в домашнем каталоге теперь будут принадлежать именно этой группе.

> :mag_right: Например, чтобы добавить пользователя в группу sudo linux используйте такую комбинацию:
```
sudo usermod -a -G sudo user
```
> :warning: Если вы не будете использовать опцию -a, и укажите только -G, то утилита затрет все группы, которые были заданы ранее, что может вызвать серьезные проблемы.

> :warning:  Например, вы хотите добавить пользователя в группу disk и стираете wheel, тогда вы больше не сможете пользоваться правами суперпользователя и вам придется сбрасывать пароль.

<p align="center">
<img src="https://media.giphy.com/media/iy9Q4mFmD1dfrJdNxG/giphy.gif">
</p>

Теперь смотрим информацию о пользователе:
```
 id [user]
```
Мы можем видеть, что была добавлена указанная нами дополнительная группа и все группы, которые были раньше остались. Если вы хотите указать несколько групп, это можно сделать разделив их запятой:
```
 sudo usermod -a -G sysadmin,adm user
```
> ### :warning: Если группа не существует, то создадим её
---
```
groupadd [OPTIONS] GROUPNAME
```
> :mag_right: Если группа существует, используем ключ `-f` (-force - заставить) 

<p align="center">
<img src="https://media.giphy.com/media/0L6ZRi1SppjtMnf42I/giphy.gif">
</p>

<p align="center">
<img src="https://media.giphy.com/media/XCCAVvLzvsr8s9zFp8/giphy.gif">
</p>

Как мы видим пользователь `devops` теперь в группе `dev`

> чтобы удалить группу
```
groupdel [OPTIONS] GROUPNAME
```
<p align="center">
<img src="https://media.giphy.com/media/aqQLY8Dz0agSl8tOH0/giphy.gif">
</p>

---
Основная группа пользователя соответствует его имени, но мы можем изменить ее на другую, например users:
```
 sudo usermod -g users user
```
> :mag_right: Теперь основная группа была изменена. Точно такие же опции вы можете использовать для добавления пользователя в группу sudo linux во время его создания с помощью команды useradd.

# :bulb: Команда «chown»
> Chown — от английского change own. Позволяет поменять или сменить владельца (пользователя) файла

Для этого, поможет следующая команда:
```
sudo chown userName avocado.txt
```
> :mag_right: В данном примере мы присвоили файл text.txt пользователю userName.

Если вы хотите поменять только группу, то можно воспользоваться командой chgrp:
```
sudo chgrp groupName avocado.txt
```
---
---
Для того чтобы не вводить 2 разные команды делают так:
```
sudo chown userName:groupName avocado.txt
```
> :mag_right: То есть вначале указывается владелец файла, а после группа:

```
sudo chown имя_владельца:имя_группы avocado.txt
```
> Если вам нужно поменять в директории владельца и группу, а там множество файлов и папок тогда используйте ключ -R:
```
sudo chown -R userName:groupName /home/sysadmin/fruits/
```
---
---
# :bulb: Команда «chmod»
> И так мы знаем, что существуют пользователи, группы. Теперь поговорим о правах доступа. Для чего этого необходимо? Например у вас есть директория в которой находятся личные файлы. Чтобы вы, владелец, например могли редактировать, просматривать файлы, группа, только видеть данные, файлы, а остальные пользователи которые не входят ни в одну из групп и не являются владельцами, вообще не могли ничего сделать, вот поэтому и необходимы права доступа.

Права на файл могут обозначаться цифрами и буквами:

|            | Цифрами | Буквами |
|------------|---------|---------|
| Чтение     |    4    |   r     |
| Запись     |    2    |   w     |
| Выполнение |    1    |   x     |
|            |    0    |   -     |

Значения прав в цифрах суммируются:
- полные права (rwx) 7  = 4 + 2 +1
- чтение и запись (rw-) 6  = 4 + 2 + 0
- чтение и выполнение (r-x) 5 = 4 + 0 + 1
- только чтение 4 (r—) = 4 + 0 + 0
- только запись 2 (-w-) = 0 + 2 + 0
- права отсутствуют (—) 0 = 0 + 0 + 0
---
---
<table>
	<tr>
  <th></th>
  <th></th>
	     <th>Владелец</th>
	     <th>Группа</th>
	     <th>Остальные</th>  
	</tr > 
 	<tr>
     <th></th>
     <th></th>
	    <th>u</th>
	    <th>g</th>
	    <th>o</th> 
	</tr > 
  	<tr>
     <td>права доступа буквы</td>
     <td>права доступа цифры</td>   
     <td></td>
     <td></td>
     <td></td>
 	</tr > 
  	<tr> 
     <td>rwxrwxrwx</td>
     <td>777</td> 
     <td colspan ="3">    читают, записывают, выполняют все</td> 
   	</tr > 
	 <tr> 
     <td>rwxr-xr-x</td>
     <td>755</td> 
     <td>  читает, записывает, выполняет</td> 
     <td colspan ="2">читать и запускать</td>
   	</tr > 
		 <tr> 
     <td>rw-r—r—</td>
     <td>644</td> 
     <td>чтение и запись</td> 
     <td colspan ="2">только четние</td>
   	</tr > 
	 <tr> 
     <td>r— — —</td>
     <td>400</td> 
     <td>читает только владец</td> 
     <td>—</td>
     <td>—</td>
   	</tr > 
</table>

> :mag_right: Изменять права доступа на файл или директорию командой chmod можно как числами, так буквами.

- ### Назначение прав доступа цифрами

Для того чтобы изменить права файлу или директорию командой chmod используя цифры, введите команду:
```
sudo chmod 755 avocado.txt
```
> :warning: Для директорий необходимо после chmod добавить ключ -R.

Чуть ниже полезная команда, как массово поменять права во всех папках и под папках.
- Для папок:

```
find /ваш_путь -type d -exec chmod 755 {} \;
```
- Для файлов:
```
find /ваш_путь -type f -exec chmod 644 {} \;
```
---
---
- ### Назначение прав доступа буквами

> :mag_right: Для новичков изменять права доступа буквами будет слегка сложней, но данные знания пригодятся.

Как вы знаете что есть владелец, группа, остальные пользователи, они обозначаются следующим образом:
<table>
	<tr>
  <th>u</th>
  <th>user</th>
  <th>Владелец</th>  
	</tr > 	
	 <tr> 
     <td>g</td>
     <td>group</td>
     <td>Пользователи, входящие в группу</td>
   	</tr > 	
	<tr> 
     <td>o</td>
     <td>others</td>
     <td>Остальные пользователи</td>
   	</tr >
	 <tr> 
     <td>a</td>
     <td>all</td>
     <td>Все пользователи</td>
   	</tr >
	</table>
	
Права доступа можно назначать, убирать или присваивать:	
<table>
       <tr>
     <td>+</td>
     <td>добавить права</td>
   	</tr >
       <tr>
     <td>—</td>
     <td>удалить права</td>
   	</tr >
       <tr>
     <td>=</td>
     <td>установить права</td>
   	</tr >
</table>

> Установить права на файл «rwxr-xr-x» (755):
```
sudo chmod u=rwx,g=rx,o=rx avocado.txt
```
Добавить права на выполнение владельцу, удалить выполнение для группы, удалить запись и выполнение для остальных:
```
sudo chmod u+x,g-x,o-wx avocado.txt
```
---
---
Добавить возможность всем (пользователь, группа, остальные) читать:
```
sudo chmod a+r avocado.txt
```
Для изменения прав доступ директориям необходимо использовать ключ -R:
```
sudo chmod -R a+r imya_papki
```
---
---
# :bulb: Команда «passwd»
> Команда passwd используется для изменения паролей пользователей

По умолчанию данная команда изменяет пароль текущего пользователя и не требует особых привилегий.
```
passwd
```
> :mag_right: Чтобы изменить пароль другого пользователя, нужны привилегии администратора. Для этого используется следующий синтаксис:
```
sudo passwd username
```
---
---
Будет запрошен пароль для команды «sudo», затем можно будет ввести новый пароль и подтвердить его.
