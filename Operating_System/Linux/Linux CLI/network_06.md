# Работа с сетью
* Работа с сетью:  nslookup, ping, nmap, netstat, =dig,  iptables, =traceroute,  =ip...
---
# :bulb: Команда «nslookup»
> Команда nslookup (поиск сервера имен), используемая для запроса DNS для получения имени домена, сопоставления IP-адресов или записей DNS.
 
Синтаксис:
```
nslookup [домен]
```
---
---
> :mag_right: Что такое ip ( Internet Protocol) ? IP-адрес – это уникальный адрес, идентифицирующий устройство в интернете или локальной сети. IP означает «Интернет-протокол» – набор правил, регулирующих формат данных, отправляемых через интернет или локальную сеть. 
 
Пример: 192.168.2.3

> :mag_right: Domain name - нужен для того чтобы не запоминать айпи адреса.

Пример: github.com

# :bulb: Команда «dig»

> dig (Domain Information Groper) - еще одна команда, используемая для исследования DNS. Это обновленная версия nslookup. Он выполняет запрос поиска DNS и отображает ответ, полученный от серверов имен. Он также используется для проверки сопоставлений DNS, записей MX и других записей DNS.
```
dig [домен]
```
---
---

# :bulb: Команда «ping»
> ping (Packet INternet Groper) - еще одна наиболее часто используемая сетевая команда для проверки связи между двумя сетевыми узлами. Он используется для измерения среднего отклика. Если мы можем отправить эхо-запрос на любой хост и если он не дал никакого ответа, мы можем предположить, что либо хост недоступен из-за каких-либо проблем с сетью, либо его брандмауэр блокирует запрос.

Синтаксис:

```
ping [домен] [айпи адрес]
```
---
---
> :mag_right: Команда Ping будет выполняться до тех пор, пока не будет прервана. Вы можете ограничить количество отправляемых пакетов, используя параметр «- c» в команде.

Синтаксис:
```
ping -c 
```
---
---
# :bulb: Команда «nmap»

> Nmap позволяет очень быстро понять какие компьютеры подключены к сети, узнать их имена, а также посмотреть какое программное обеспечение на них установлено, какая операционная система и какие типы фильтров применяются.

### Как работает nmap?

> :mag_right: В компьютерных сетях все подключенные устройства имеют свой ip адрес. Каждый компьютер поддерживает протокол ping, с помощью которого можно определить подключен ли он к сети. Мы просто отправляем ping запрос компьютеру, и если он отзывается, то считаем, что он подключен. Nmap использует немного иной подход. Компьютеры также определенным образом реагируют на те или иные сетевые пакеты, утилита просто отправляет нужные пакеты и смотрит какие хосты прислали ответ.
---
> :mag_right: Утилита nmap в процессе сканирования сети перебирает доступный диапазон портов и пытается подключиться к каждому из них. Если подключение удалось, в большинстве случаев, передав несколько пакетов программа может даже узнать версию программного обеспечения, которые ожидает подключений к этому порту. 

### Как пользоваться nmap для сканирования портов в Linux

Теперь давайте рассмотрим основные опции, которые нам понадобятся.

* -sL - просто создать список работающих хостов, но не сканировать порты nmap;
* -sP - только проверять доступен ли хост с помощью ping;
* -PN - считать все хосты доступными, даже если они не отвечают на ping;
* -sS/sT/sA/sW/sM - TCP сканирование;
* -sU - UDP сканирование nmap;
* -sN/sF/sX - TCP NULL и FIN сканирование;
* -sC - запускать скрипт по умолчанию;
* -sI - ленивое Indle сканирование;
* -p - указать диапазон портов для проверки;
* -sV - детальное исследование портов для определения версий служб;
* -O - определять операционную систему;
* -T[0-5] - скорость сканирования, чем больше, тем быстрее;
* -D - маскировать сканирование с помощью фиктивных IP;
* -S - изменить свой IP адрес на указанный;
* -e - использовать определенный интерфейс;
* --spoof-mac - установить свой MAC адрес;
* -A - определение операционной системы с помощью скриптов.





Дальше рассмотрим примеры nmap. Сначала давайте рассмотрим как найти все подключенные к сети устройства, для этого достаточно использовать опцию -sL и указать маску нашей сети. в моем случае это 192.168.1.1/24. Маску вашей локальной сети вы можете найти, выполнив команду:


```
ip addr show
```
---
---
Из вывода для используемого интерфейса возьмите число после слеша, а до слэша укажите ip вашего роутера. Команда на сканирование сети nmap будет выглядеть вот так:

```
nmap -sL 192.168.1.1/24
```
---
---

Иногда это сканирование может не дать никаких результатов, потому что некоторые операционные системы имеют защиту от сканирования портов. Но это можно обойти, просто использовав для сканирования ping всех ip адресов сети, для этого есть опция -sn:

```
nmap -sn 192.168.1.1/24
```
Как видите, теперь программа обнаружила активные устройства в сети. Дальше мы можем сканировать порты nmap для нужного узла запустив утилиту без опций:

```
sudo nmap 192.168.1.1
```
> :mag_right: Теперь мы можем видеть, что у нас открыто несколько портов, все они используются каким-либо сервисом на целевой машине. Каждый из них может быть потенциально уязвимым, поэтому иметь много открытых портов на машине небезопасно. Но это еще далеко не все, что вы можете сделать, дальше вы узнаете как пользоваться nmap.

Чтобы узнать более подробную информацию о машине и запущенных на ней сервисах вы можете использовать опцию -sV. Утилита подключится к каждому порту и определит всю доступную информацию:

```
sudo nmap -sV 192.168.1.1
```
> На нашей машине запущен ftp, а поэтому мы можем попытаться рассмотреть эту службу подробнее с помощью стандартных скриптов nmap. Скрипты позволяют проверить порт более детально, найти возможные уязвимости. Для этого используйте опцию -sC и -p чтобы задать порт:

```
sudo nmap -sC 192.168.56.102 -p 21
```
> Мы выполняли скрипт по умолчанию, но есть еще и другие скрипты, например, найти все скрипты для ftp вы можете командой:
```
sudo find /usr/share/nmap/scripts/ -name '*.nse' | grep ftp
```
Затем попытаемся использовать один из них, для этого достаточно указать его с помощью опции --script. Но сначала вы можете посмотреть информацию о скрипте:
```
sudo nmap --script-help ftp-brute.nse
```
Этот скрипт будет пытаться определить логин и пароль от FTP на удаленном узле. Затем выполните скрипт:
```
sudo nmap --script ftp-brute.nse 192.168.1.1 -p 21
```
> :mag_right: В результате скрипт подобрал логин и пароль, admin/admin. Вот поэтому не нужно использовать параметры входа по умолчанию.

Также можно запустить утилиту с опцией -A, она активирует более агрессивный режим работы утилиты, с помощью которого вы получите большую часть информации одной командой:
```
sudo nmap -A 192.168.1.1
```
---
---

# :bulb: Команда «netstat»

> Команда netstat (network statistics) используется для проверки каждого сетевого подключения и открытия сокетов на устройстве Linux. Он предоставляет информацию о соединениях, открытых сокетах и таблицах маршрутизации.

Для установки в linux (Ubuntu):
```
sudo apt-get install net-tools
```
Синтаксис:

```
netstat
```
---
---

Эту команду также можно использовать с дополнительными параметрами.
```
netstat -tulpn
```
---
---
* -t - Отображение текущего подключения в состоянии переноса нагрузки с процессора на сетевой адаптер при передаче данных ( "offload" ).


* -p протокол - вывод подключений для протокола, указанного параметром протокол. В этом случае параметр протокол может принимать значения tcp, udp, tcpv6 или udpv6. Если данный параметр используется с ключом -s для вывода статистики по протоколу, параметр протокол может иметь значение tcp, udp, icmp, ip, tcpv6, udpv6, icmpv6 или ipv6.

* -n - вывод активных подключений TCP с отображением адресов и номеров портов в числовом формате без попыток определения имен.



